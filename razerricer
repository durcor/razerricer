#!/usr/bin/env python

# Based off of https://github.com/bisspector/openrazer_pywal
# with tweaks for better random colors

import random
import os

exec(open(os.environ["XDG_CACHE_HOME"] + '/wal/colors.py', "rb").read())

from openrazer.client import DeviceManager

# Create a DeviceManager. This is used to get specific devices
device_manager = DeviceManager()

# Convert the hex values generated by pywal
# into RGB tuples.
def hex_to_rgb(s):
    s = s.lstrip("#")
    return tuple(int(s[i:i+2], 16) for i in (0, 2 ,4))

wal_colors = list(map(hex_to_rgb, colors))[1:7]

# Disable daemon effect syncing.
# Without this, the daemon will try to set the lighting effect to every device.
device_manager.sync_effects = False

# Helper funciton to generate interesting colors
def random_color():
    color = random.choice(wal_colors)
    return color

if not device_manager.devices:
    print ('Error: No razer devices found!')
    exit(1)

# Set random colors for each zone of each device
for device in device_manager.devices:
    for row in range(device.fx.advanced.rows):
        for col in range(device.fx.advanced.cols):
            device.fx.advanced.matrix[row, col] = random_color()

    device.fx.advanced.draw()

# Print the devices which have been changed
print("Applied wal colors to: [", end='')
devstring = ""
for device in device_manager.devices:
    if not devstring:
        devstring += "'" + str(device) + "'"
    else:
        devstring += ", '" + str(device) + "'"
devstring += ']\n'

print(devstring)
